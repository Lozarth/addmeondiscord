<!DOCTYPE html>
<html>

<head>
    <title>Profile - Add me on Discord</title>

    <meta property="og:type" content="website" />

    <script>
        var id = window.location.hash.substr(1)
        console.log(id)

        if (id.startsWith('#')) {
            id = id.substr(1)
        }

        if (id === undefined || id === '' || id === null || isNaN(id)) {
            window.location.href = '/instructions.html'
        }
    </script>

    <script>
        // Fetch user info from replit proxy and edit meta tags and title accordingly
        fetch(`https://addmeondiscord.lozarth.repl.co/userinfo/${id}`)
            .then(response => response.json())
            .then(data => {
                /*
                Example data:
                    {
                        "id": "339492485854396426",
                        "username": "shrigma",
                        "avatar": "da2a8e2e5d4edee5ee2b1fffbf662944",
                        "avatar_decoration": null,
                        "discriminator": "1957",
                        "public_flags": 4194304,
                        "banner": "e3ae8548630df417644106785c70c8c8",
                        "banner_color": null,
                        "accent_color": null
                    }
                */

                console.log(data)

                document.title = `${data.username}#${data.discriminator} - Add me on Discord`

                const metaTitle = document.createElement('meta')
                metaTitle.property = 'og:title'
                metaTitle.content = `Add ${data.username}#${data.discriminator} on Discord!`

                const metaDescription = document.createElement('meta')
                metaDescription.property = 'og:description'
                metaDescription.content = `https://discordprofile.lozarth.xyz/`

                const metaImage = document.createElement('meta')
                metaImage.property = 'og:image'
                metaImage.content = `https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.png`


                document.getElementsByTagName('head')[0].appendChild(meta)
            })
    </script>
</head>

<body>
    <h1 id='countdown'>Beaming profile to Discord in 5 seconds...</h1>

    <p id='manual'>Don't have Discord installed? Use the web version <a id="manualurl" href=''>here</a>.</p>

    <a id='source' href='https://github.com/Lozarth/addmeondiscord'>Website Source</a>

    <script>
        const manualurl = document.getElementById('manualurl')

        manualurl.href = `https://discord.com/users/${id}`

        // ----- //

        const countdown = document.getElementById('countdown')

        function redirectCountdown() {
            let redirectTime = 5

            const interval = setInterval(function () {
                redirectTime--

                if (redirectTime === 0) {
                    console.log(id)

                    countdown.innerHTML = `We've beamed the profile to your Discord app.`
                    clearInterval(interval)
                    window.location.href = `discord://-/users/${id}`
                } else {
                    countdown.innerHTML = `Beaming profile to Discord in ${redirectTime} seconds...`
                }
            }, 1000)
        }

        redirectCountdown()
    </script>

    <style>
        body {
            background-color: #2f3136;
            color: #dcddde;
            font-family: 'Whitney', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        #countdown {
            font-size: 2em;
            text-align: center;
        }

        #manual {
            text-align: center;
        }

        #manualurl {
            color: #46a7ff;
            text-decoration: none;
        }

        #source {
            position: absolute;
            bottom: 0;
            right: 0;
            margin: 10px;
            color: #dcddde;
            text-decoration: none;
        }
    </style>
</body>

</html>
